# ClickHouse E-commerce Analytics System

## Описание
Аналитическая система для анализа каталога товаров и пользовательских событий интернет-магазина Ozon на базе ClickHouse с мониторингом через Prometheus и Grafana.

## Архитектура
- **ClickHouse** - колоночная СУБД для аналитических запросов
- **Prometheus** - сбор метрик производительности ClickHouse
- **Grafana** - визуализация бизнес- и технических метрик

## Установка и запуск

1. Убедитесь, что у вас установлены:
   - Docker
   - Docker Compose

2. Склонируйте репозиторий:
```bash
git clone https://github.com/Dasevil/clickhouse-ecommerce-analytics.git
```

3. Запустите систему:
```bash
cd clickhouse-ecommerce-analytics
bash scripts/startup.sh
```

## Структура данных

### Таблицы
- **ecom.ecom_offers** - каталог товаров (ReplacingMergeTree)
- **ecom.raw_events** - пользовательские события (MergeTree)

### Материализованные представления
- **catalog_by_category_mv** - агрегаты по категориям товаров
- **catalog_by_brand_mv** - агрегаты по брендам
- **catalog_coverage_mv** - анализ покрытия каталога событиями

## Аналитические запросы
Скрипт `scripts/analytical_queries.py` выполняет:
- Топ-20 категорий по количеству товаров
- Топ-30 брендов по количеству товаров
- Среднее количество товаров по брендам в категориях
- Анализ товаров без пользовательских событий

## Тестирование производительности
Скрипт `scripts/performance_test.py` сравнивает время выполнения запросов:
- Через материализованные представления
- По сырым данным

Ожидаемое ускорение: 20-50x

## Мониторинг

### Grafana дашборды
Доступны по адресу: `http://localhost:3000`

1. **Business Metrics**
   - Топ категорий
   - Топ брендов
   - Покрытие каталога событиями
   - Активность по устройствам

2. **Technical Metrics**
   - QPS (запросов в секунду)
   - Латентность запросов
   - Использование памяти ClickHouse
   - Загрузка CPU

### Prometheus
Метрики доступны по адресу: `http://localhost:9090`

## Выводы

### Применимость ClickHouse для e-commerce
- ✅ Высокая производительность аналитических запросов
- ✅ Эффективная агрегация больших объемов данных
- ✅ Поддержка материализованных представлений
- ✅ Интеграция с экосистемой мониторинга
- ✅ Хорошая сжатие данных

### Рекомендации
1. Использовать материализованные представления для часто выполняемых агрегаций
2. Правильно выбирать ключи сортировки и партиционирования
3. Регулярно мониторить производительность через Grafana
4. Оптимизировать размер партиций под рабочую нагрузку

## Лицензия
MIT
